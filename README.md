# 高级字幕图层生成器 (Advanced Subtitle Overlay Generator)

这是一个用于生成带有自定义样式和效果的字幕图片的 Python 应用程序。用户可以加载字幕文件（目前支持简单文本格式），调整字体、颜色、大小、位置和各种效果（如阴影、描边），并为每一行字幕（主字幕和可选的翻译字幕）生成透明背景的 PNG 图片。

## 特点

-   **双行字幕**：支持主字幕和翻译字幕。
-   **自定义样式**：
    -   分别为两行字幕设置字体、大小、颜色。
    -   文本对齐方式：左对齐、居中、右对齐。
    -   通过 X/Y 坐标精确定位字幕（基于屏幕左下角）。
-   **文本效果**：
    -   阴影（可自定义偏移和颜色）。
    -   描边（可自定义宽度和颜色）。
    -   渐变色填充。
-   **实时预览**：在调整设置时即时看到字幕效果。
    -   支持加载自定义背景图片进行预览，以模拟在视频中的实际效果。
-   **多种分辨率**：支持生成 720p 和 1080p 的字幕图层。
-   **批量生成**：从字幕文件解析多条目并批量生成 PNG 图片。

## 安装

1.  **克隆或下载项目**
    ```bash
    # 如果使用 git
    git clone <repository_url>
    cd <project_directory>
    ```

2.  **创建虚拟环境 (推荐)**
    ```bash
    python -m venv venv
    # Windows
    .\venv\Scripts\activate
    # macOS/Linux
    source venv/bin/activate
    ```

3.  **安装依赖**
    项目依赖 Pillow 库。通过以下命令安装：
    ```bash
    pip install -r requirements.txt
    ```

## 使用方法

1.  运行应用程序：
    ```bash
    python gui.py
    ```
2.  **选择字幕文件**：点击“浏览...”选择一个 `.txt` 文件。文件格式应为：
    ```
    [任意标签1] 这是主字幕文本1
    [任意标签1ch] This is translation text 1 (可选)

    [任意标签2] 这是主字幕文本2
    [任意标签2ch] This is translation text 2 (可选)
    ...

    # 例如:
    [Verse1] Some original lyrics
    [Verse1ch] Some translated lyrics

    [Info] Important Information (没有翻译)
    ```
    - 空行会被忽略。
    - 每一条字幕由一个标签和文本组成，格式为 `[标签]文本内容`。
    - 如果一行是翻译字幕，其标签应以 `ch` (不区分大小写，但解析器内部转为小写处理) 结尾，并且其 `ch` 前面的部分应与对应的主字幕标签相同。
    - 例如，`[MyTag]` 是主字幕，`[MyTagch]` 或 `[MyTagCH]` 是其对应的翻译。
3.  **选择输出目录**：指定生成的 PNG 图片保存的位置。
4.  **调整设置**：
    -   **通用设置**：选择分辨率、文本对齐方式，并输入主字幕和翻译字幕的 X/Y 坐标。
    -   **主字幕 (Sub)** 和 **翻译字幕 (SubCh)** 标签页：分别设置字体、大小、颜色和效果。
5.  **(可选) 添加预览背景**：点击“添加预览背景”按钮加载一张图片，以便在特定背景下预览字幕效果。
6.  **生成图片**：点击“生成PNG图片”按钮开始处理。状态信息会显示在按钮旁边。

## 文件结构

```
.
├── core/                  # 核心逻辑
│   ├── parser.py          # 字幕文件解析
│   ├── renderer.py        # 字幕渲染引擎
│   └── utils.py           # 工具函数
├── gui.py                 # 主GUI应用程序脚本
├── main.py                # (可能是旧的入口或CLI版本，当前主要使用gui.py)
├── requirements.txt       # Python依赖列表
├── README.md              # 本文件
├── sample_lyrics.txt      # 示例字幕文件
└── output_images/         # 默认输出目录
```

## 注意事项

-   确保所选字体文件支持您字幕中使用的字符（例如，中文字幕需要包含中文字形的字体）。
-   X/Y 坐标以屏幕左下角为原点，Y 值定义的是文本行的底部边缘。